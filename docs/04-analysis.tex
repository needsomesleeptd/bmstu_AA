\chapter{Аналитический раздел}


В данном разделе рассматриваются классический алгоритм умножения матриц и алгоритм Винограда, а также его оптимизированная версия.

\subsection{Определение матрицы}

\textbf{Матрица} \cite{book_matrix} представляет собой таблицу чисел $a_{ik}$ следующего вида:
\begin{equation}
	\begin{pmatrix}
		a_{11} & a_{12} & \ldots & a_{1n}\\
		a_{21} & a_{22} & \ldots & a_{2n}\\
		\vdots & \vdots & \ddots & \vdots\\
		a_{m1} & a_{m2} & \ldots & a_{mn}
	\end{pmatrix},
\end{equation}

где $m$ - количество строк, а $n$ - количество столбцов. Элементы $a_{ik}$ называются элементами матрицы.

Если $A$ - матрица, то $A_{i,j}$ обозначает элемент матрицы, расположенный на \textit{i-й} строке и \textit{j-м} столбце.

Существуют различные операции, выполняемые с матрицами:
\begin{enumerate}
	\item Сложение матриц одинакового размера;
	\item Вычитание матриц одинакового размера;
	\item Умножение матриц, 
	если количество столбцов в первой матрице равно количеству строк во второй матрице.
	Результатом является матрица, у которой количество строк равно количеству строк первой матрицы, 
	а количество столбцов - количеству столбцов второй матрицы. 
\end{enumerate}

\textit{Замечание:} в общем случае операция умножения матриц, 
когда в первой матрице число столбцов не равно числу строк во второй не определена.
Также стоит отметить что операция умножения матриц не коммутативна ($A \cdot B$ не всегда равно $B \cdot A$).

\clearpage

\subsection{Классический алгоритм}

Допустим, у нас есть две матрицы

\begin{equation}
	\label{eq:an_matrixies}
	A_{lm} = \begin{pmatrix}
		a_{11} & a_{12} & \ldots & a_{1n}\\
		a_{21} & a_{22} & \ldots & a_{2n}\\
		\vdots & \vdots & \ddots & \vdots\\
		a_{m1} & a_{m2} & \ldots & a_{mn}
	\end{pmatrix},
	\quad
	B_{mn} = \begin{pmatrix}
		b_{11} & b_{12} & \ldots & b_{1n}\\
		b_{21} & b_{22} & \ldots & b_{2n}\\
		\vdots & \vdots & \ddots & \vdots\\
		b_{m1} & b_{m2} & \ldots & b_{mn}
	\end{pmatrix},
\end{equation}

В таком случае умножение происходит по принципу <<строка на столбец>>, результом умножения матриц, заданных в
\ref{eq:an_matrixies} ($A \cdot B$), является матрица $C$, расчитанная по формуле (\ref{eq:an_def_mat_mul}).


\begin{equation}
	\label{eq:an_def_mat_mul}
	c_{ij} =
	\sum_{r=1}^{m} a_{ir}b_{rj} \quad (i=\overline{1,l}; j=\overline{1,n})
\end{equation}


\subsection{Алгоритм Винограда}

В 1987 году Дон Копперсмит и Виноград опубликовали метод, 
содержащий асимптотическую сложность $O(n^{2,3755})$ и улучшили 
его в 2011 до $O(n^{2,373})$, где $n$ -- размер сторон матрицы \cite{book_vinograd}.
В основной идее алгоритма были заложены следующие рассуждения:
Если посмотреть на результат умножения двух матриц, 
то видно, 
что каждый элемент в нем представляет собой 
скалярное произведение соответствующих строки и 
столбца исходных матриц. 
Можно заметить также, что такое умножение допускает предварительную 
обработку, позволяющую часть работы выполнить заранее.
Рассмотрим два вектора $V = (v_1, v_2, v_3, v_4)$ и $W = (w_1, w_2, w_3, w_4)$. Их скалярное произведение равно:
$V \cdot W = v_1w_1 + v_2w_2 + v_3w_3 + v_4w_4$.
Это равенство можно переписать в виде~(\ref{eq:vin_algo}).
\begin{equation}
	\label{eq:vin_algo}
	V \cdot W = (v_1 + w_2)(v_2 + w_1) + (v_3 + w_4)(v_4 + w_3) - v_1v_2 - v_3v_4 - w_1w_2 - w_3w_4.	
\end{equation}

Пусть матрицы $A, B, C$, ранее определенных размеров. Скалярное произведение (\ref{eq:vin_algo}), по замыслу Винограда, можно использовать при расчете 
произведения матриц~(\ref{eq:vin_mul_matrix}).
\begin{equation} 
	\label{eq:vin_mul_matrix}
	C_{ij} = \sum_{k=1}^{q/2}(a_{i,2k-1} + b_{2k,j})(a_{i,2k} + b_{2k-1,j}) - \sum_{k=1}^{q/2} a_{i,2k-1}a_{i,2k} - \sum_{k=1}^{q/2} b_{2k-1,j}b_{2k,j}
\end{equation}


Заметим, что в выражении (\ref{eq:vin_algo}), операнды со знаком $-$ могут быть вычислены заранее для каждой
строки и каждого столбца исходных матриц, а затем переиспользовать полученные значения что позволяет на практике заметно ускорить расчеты.
Аналгично с (\ref{eq:vin_mul_matrix}), единожды вычислив $\sum_{k=1}^{q/2}a_{i,2k-1}a_{i,2k}$ для строки, можно использовать данное
значение для получения значения любого произведения с операндами данной строки. При  предварительном расчете 
значений столбцов используется аналогичная идея.



\subsection{Оптимизированный алгоритм Винограда}

При программной реализации рассмотренного выше алгоритма Винограда можно сделать следующие оптимизации:
\begin{enumerate}
	\item значение $\frac{N}{2}$, используемое как ограничения цикла подсчёта предварительных данных, можно кэшировать;
	\item операцию умножения на 2 программно эффективнее реализовывать как побитовый сдвиг влево на 1;
	\item операции сложения и вычитания с присваиванием следует реализовывать при помощи соответствующего оператора \texttt{+=} или \texttt{-=} (при наличии данных операторов в выбранном языке программирования).
\end{enumerate}

\subsection{Алгоритм Штрассена}
Фолькер Штрассен предложил разбить матрицу на матрицы размером $2x2$, после чего посчитать их произведение. Было доказано, что в случае, если необходимо вычислить
произведение 2 матриц размерности $2x2$, над кольцом $R$. То это возможно сделать за 7 умножений и 18 сложений в $R$. В данном случае $R$ — кольцо, т.е., ассоциативные операции сложения и умножения, сложение коммутативно, дистрибутивность, нейтральные элементы, противоположный элемент относительно
сложения (без противоположного элемента — полукольцо) \cite{strassen}.

Стоит отметить, что данный алгоритм в общем случае применим только к квадратным матрицам размерности $nxn$, где $n$ - некая неотрицательная степень двойки.
Исходная матрица рекурсивно разделяется на 4 матрицы размерностью $\frac{n}{2}$.
Пока не будет достигнуты матрицы с размерностью $2\times2$, вычисление которых происходит тривиально по классическому алгоритму умножения матриц. После чего вычисляются 7 произведений (\ref{eq:strs_d}).
\begin{equation}
	\label{eq:strs_d}
	\begin{aligned}
		d1 & = (a_{11} + a_{22})(b_{11}+b_{22}), \\
		d2 & = (a_{21} + a_{22})b_{11}, \\
		d3 & = a_{11}(b_{12}-b_{11}), \\
		d4 & = a_{22}(b_{21} - b_{11}),\\
		d5 & = (a_{11}+a_{12})b_{22}, \\
		d6 & = (a_{21} - a_{11})(b_{11} + b_{12}), \\
		d7 & = (a_{12} - a_{22})(b_{21} + b_{22}).
	\end{aligned}
\end{equation}
После вычисления (\ref{eq:strs_d}), результат искомого произведения $C=AB$, а именно
матрицу $C$, можно записать как (\ref{eq:strs_cs}).


\begin{equation}
	\label{eq:strs_cs}
	\begin{aligned}
		c_{11} & = d1 + d4 + d7 -d5, \\
		c_{12} & = d3 + d5, \\
		c_{21} & = d2 + d4, \\
		c_{22} & = d1 + d3 + d6 -d2.
	\end{aligned}
\end{equation}

Смысл умножения матриц $2\times2$ за 7 умножений и много сложений в том, что эту формулу для произведения
матриц можно применять рекурсивно, сводя умножение матриц размера $n\times n$ к умножению
семи пар матриц вдвое меньшего размера — семи, а не восьми.




\textbf{Вывод}

В данном разделе было введено понятие матрицы, определены несколько операций на ней, 
а также рассмотрена операция умножения матриц.
В данном разделе мы изучили матрицы и операции, 
которые можно выполнять с ними, включая умножение. 
Было рассмотрено три алгоритма умножения матриц: классический и алгоритм Винограда, а также алгоритма Штрассена.
Алгоритм Винограда выделяется своей эффективностью благодаря использованию предварительных вычислений.
Алгоритм Штрассена позволяет уменьшить число операций благодаря использованию рекурсивной формулы.
Также были введены  различные оптимизации, которые можно учесть при реализации алгоритма Винограда для 
достижения более высокой производительности.